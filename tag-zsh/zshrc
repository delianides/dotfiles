stty -ixon

# makes color constants available
autoload -U colors
colors

export GPG_TTY=$(tty)
export PATH="$PATH:~/.bin"

## Command history configuration
if [ -z "$HISTFILE" ]; then
  HISTFILE=$HOME/.zsh_history
fi

HISTSIZE=10000
SAVEHIST=10000

# Show history
case $HIST_STAMPS in
  "mm/dd/yyyy") alias history='fc -fl 1' ;;
  "dd.mm.yyyy") alias history='fc -El 1' ;;
  "yyyy-mm-dd") alias history='fc -il 1' ;;
  *) alias history='fc -l 1' ;;
esac

setopt APPEND_HISTORY
setopt EXTENDED_HISTORY
setopt HIST_EXPIRE_DUPS_FIRST
setopt HIST_IGNORE_DUPS # IGNORE DUPLICATION COMMAND HISTORY LIST
setopt HIST_IGNORE_SPACE
setopt HIST_VERIFY
setopt INC_APPEND_HISTORY
setopt SHARE_HISTORY # SHARE COMMAND HISTORY DATA
setopt NO_BG_NICE
setopt NO_HUP                    # don't kill background jobs when the shell exits
setopt NO_LIST_BEEP
setopt LOCAL_OPTIONS
setopt LOCAL_TRAPS
setopt PROMPT_SUBST
setopt EXTENDED_GLOB
setopt INC_APPEND_HISTORY
setopt AUTOPUSHD
unsetopt AUTO_CD 

source $HOME/.config/op/plugins.sh
export ZINIT_HOME=/opt/homebrew/opt/zinit
source $ZINIT_HOME/zinit.zsh

zpcompinit 
zi load Aloxaf/fzf-tab
zi light zsh-users/zsh-completions 
zi light zsh-users/zsh-autosuggestions 
zi light zdharma-continuum/fast-syntax-highlighting
zi snippet OMZ::/plugins/sudo/sudo.plugin.zsh
zi light zsh-users/zsh-history-substring-search

zi ice as"completion"
zi snippet OMZP::git/git.plugin.zsh

zi ice as"completion"
zi snippet OMZP::git-flow/git-flow.plugin.zsh

zi ice if"[[ $OSTYPE == *darwin* ]]"
zi snippet OMZ::lib/clipboard.zsh

zi ice lucid wait'0'
zi light joshskidmore/zsh-fzf-history-search

zi ice depth=1
zi light jeffreytse/zsh-vi-mode

ZSH_AUTOSUGGEST_HIGHLIGHT_STYLE='fg=8'
ZVM_VI_ESCAPE_BINDKEY=jj
ZVM_VI_INSERT_ESCAPE_BINDKEY=jj
ZVM_INIT_MODE=sourcing

zstyle ':fzf-tab:complete:cd:*' fzf-preview 'exa -1 --color=always $realpath'

. $(brew --prefix asdf)/libexec/asdf.sh

eval "$(direnv hook zsh)";
eval "$(zoxide init zsh)"
eval "$(starship init zsh)"


for file in ~/.{aliases,functions,dockerfunc,path,extra,exports,localrc,fzf.zsh}; do
	if [[ -r "$file" ]] && [[ -f "$file" ]]; then
		# shellcheck source=/dev/null
		source "$file"
	fi
done

if [ -z "$TMUX" ]; then
  bindkey -s "^p" 'ta\n';
fi

enable-fzf-tab

# Returns the name of the most recent tmux session, sorted by time the session
# was last attached.
# if ! _in_ssh && ! _in_vs_code; then
#   connect_to_most_recent_tmux_session
# fi
